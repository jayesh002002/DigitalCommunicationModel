clear all;close all;%----------------------------------------------------%---------------- Initial Parameters ----------------%----------------------------------------------------n = 8;     %number of bitsM = 4;        %4-QAMk = log2(M);  %number of bits in one symbolm = n/k; %number of symbolsif mod(n, k) ~= 0    error('numberOfBits must be a multiple of log2(M).');endnumSamplesPerSymbol = 1;    % Oversampling factorFc_tx = 10;    %carrier frequency : 3MHzphase_tx = 0;     %carrier phaseFs = Fc_tx * 2.1;t = (0:0.001:1 - 0.001);%----------------------------------------------------%----------------Creation of the bitstream ----------%----------------------------------------------------dataIn = randi(2,1,n) - 1;  % Generate vector of binary datadataIn = [0 0 1 1 1 0 0 1]%----------------------------------------------------%----------------- QAM Mapper -----------------------%----------------------------------------------------numberOfSymbols = length(dataIn)/k; %number of symbols in the FIFO% Define mapping table applying Gray mappingmappingTable(1) =  1 + 1*i;mappingTable(2) = -1 + 1*i;mappingTable(3) =  1 - 1*i;mappingTable(4) = -1 - 1*i;mappedSymbols = zeros(1, numberOfSymbols);% Map bits to symbolsfor i = 1:k:length(dataIn)     symbolBits = dataIn(i:i+k-1);  symbolIndex = 2^1 * symbolBits(1) + 2^0 * symbolBits(2);     % Mapping   mappedSymbols((i - 1)/k + 1) = mappingTable( symbolIndex + 1);   endfor%----------------------------------------------------%----------------- Upsampling -----------------------%----------------------------------------------------mappedSymbols_upsampled = 0;mappedSymbols_upsampled(1) = mappedSymbols(1);upscaling_factor = (length(t)-1)/(length(mappedSymbols) - 1);for i = 2:length(mappedSymbols)    temp = mappedSymbols(i-1)*ones(1,upscaling_factor-1);    mappedSymbols_upsampled = [mappedSymbols_upsampled, temp, mappedSymbols(i)];endmappedSymbols_upsampled = [mappedSymbols_upsampled mappedSymbols(length(mappedSymbols))*ones(1,(length(t)-length(mappedSymbols_upsampled)))];%----------------------------------------------------%----------------- Modulation: Baseband to RF -------%----------------------------------------------------Tx_I = real(mappedSymbols_upsampled) .* (sqrt(2)*cos(2*pi*Fc_tx*t+phase_tx));Tx_Q = imag(mappedSymbols_upsampled) .* (sqrt(2)*sin(2*pi*Fc_tx*t+phase_tx));%Tx = Tx_I - Tx_Q;Tx = Tx_I;%----------------------------------------------------%----------------- Figures --------------------------%----------------------------------------------------##figure(1);##stem(dataIn,"filled");##title('Data In');##xlabel('Bit Index');##ylabel('Binary Value');##figure(2);##subplot(2,1,1);##stem(real(mappedSymbols));##title("Real part")##subplot(2,1,2);##stem(imag(mappedSymbols));##title("Imaginary part");##figure(3);##scatter(real(mappedSymbols), imag(mappedSymbols) , "filled");##axis([-2 2 -2 2]);##title("Symbols");##figure(4);##subplot(3,1,1);##stem(real(mappedSymbols));##subplot(3,1,2);##stem(real(mappedSymbols_upsampled));##subplot(3,1,3);##plot(Tx_I);figure(4);##subplot(3,1,1);##plot(Tx_I);##subplot(3,1,2);##plot(Tx_Q);##subplot(3,1,3);plot(Tx_I);